<!DOCTYPE html>
<!-- saved from url=(0032)https://www.i3jf.com/super/trace -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<link rel="shortcut icon" href="{{static_url}}images/browserLogo.ico">
		<title>超级积分I3JF.com、省钱网购首选、正品保障、配送便捷、积分当钱花，省钱购购购！</title>

		<meta name="renderer" content="webkit">
		<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
		<meta name="keywords" content="积分购物,积分商城,手机,笔记本,电脑,零食,CD,VCD,DV,相机,数码,配件,手表,存储卡,超级积分">
		<meta name="description" content="超级积分I3JF.COM-专业的综合网上积分购物商城,销售家电、数码通讯、电脑、家居百货、服装服饰、母婴、图书、食品等数千个品牌优质商品.便捷、诚信的服务，为您提供愉悦的网上购物体验!">

		<link rel="stylesheet" href="{{static_url}}css/base.css">
		<link rel="stylesheet" href="{{static_url}}css/style.css">
		<link rel="stylesheet" href="{{static_url}}css/full_order.css">
		<link rel="stylesheet" href="{{static_url}}css/follow.css">

		<script type="text/javascript" src="{{static_url}}js/jquery.js"></script>

	</head>
	<body>
		<div id="top">
			<div id="topAd"></div>
			<div id="nav">
				<div id="loginMenu">
					<div class="left backToHome">
						<a href="/">
							<img src="{{static_url}}images/index.png" alt="">
							<span>返回首页</span>
						</a>
					</div>
					<ul class="right  ">
						<li class="left unloginStatus"><a href="/api/user/login" class="offline">[登录]</a></li>
						<li class="left unloginStatus"><a href="/api/user/register/">[免费注册]</a></li>
						<li class="left cart"><a class="myCart" data-href="/api/user/mycart" onclick="check_login(this);">购物车 <span>(0)</span></a></li>
						<li class="left"><a href="javascript:void(0);" onclick="toHelper();">帮助中心</a></li>
						<!-- <li class="left"><a href="javascript:void(0);">客户服务</a></li> -->
					</ul>
				</div>
			</div>
		</div>
		<div id="pageHead">
			<div class="pageheadContent">
				<div class="leftHead">
					<div class="mainTittle left">
						<a href="/"><img src="{{static_url}}images/logo.png" alt=""></a>
					</div>
											<div class="separateD" style="border-right: 4px solid rgb(102, 102, 102);"></div>
										<div class="subTittle left" style="display: inline-block;">
						<span class="subWord">
															我的足迹
													</span>
					</div>
				</div>
				<div class="searchOverall">
										<input type="text" placeholder="请输入搜索内容" class="left searchInput">
					<span class="left searchBtn">搜&nbsp;&nbsp;索</span>
				</div>
			</div>
		</div>
		<div id="containerBox">
			<div id="container" class="">
				<div class="fol-body">
				    <div class="" id="traceContent">
				        <ul class="trace-list"></ul>
				 	</div>

				    <div class="trace-emp hidden" id="traceEmp">
				        <p class="cat-img"><img src="{{static_url}}images/tracenull.png" alt="" title=""></p>
				        <div class="emp-tips">
				            <span>暂无浏览记录</span>
				        </div>
				    </div>

				    <div class="imgLoad" id="loading">
				        <div class="outer"></div>
				        <div class="inner"></div>
				    </div>

				    <div class="clear"></div>
				</div>
				<div class="tcdPageCode" page="1" style="display: block;">
					<button id="prev" class="page-button" disabled="disabled" style="background: rgb(245, 245, 245); color: rgb(51, 51, 51);">上一页</button>

					<button id="next" class="page-button" style="background: rgb(255, 255, 255);">下一页</button>
					<span class="page-info">1/1</span>
				</div>
			</div>
		</div>
				<div id="footer">
			<div id="footerContent">
				<div class=" ">
					<p>版权所有深圳前海艾智信科技有限公司
					</p>
					<a href="http://www.miibeian.gov.cn/" target="_blank">©2016&nbsp;&nbsp;I3JF&nbsp;&nbsp;粤ICP备16021142号-1</a>
				</div>
				<ul class="right ">
					<!-- <li class="left">法律声明</li> -->
					<li class="left" onclick="toHelper(4,1)">服务条款</li>
					<li class="left" onclick="toHelper(4,2)">隐私声明</li>
					<li class="left" onclick="toHelper(4,0)">关于我们</li>
					<li class="left" onclick="toHelper(2,3)">联系我们</li>
					<!-- <li class="left">网站导航</li> -->
				</ul>
			</div>
		</div>
		<div class="toolback"></div>
		<div class="tooltip">
			<div class="cue">
				<h3></h3>
				<span></span>
			</div>
			<div class="delBox">
					<strong></strong>
					<p></p>
					<div class="cancel">
						<button class="confirm left"></button>
						<button class="abolish right"></button>
					</div>
			</div>
		</div>

		<script type="text/javascript" src="{{static_url}}js/publics.js"></script>
		<script type="text/javascript">

			var checkLogin = new checkLogin();//判断登录
            if (checkLogin.flag) {
                logged_in(); //已登陆
            }else{
                not_logged_in(); //未登录
                // window.location.href = '/static/login/index.html';
            };

            //未登录可以执行的方法
            function not_logged_in(){
                getCategoryList();//获取分类导航
                setSortListHover();//分类导航hover
            };
            //已登录执行的方法
            function logged_in(){
                getCategoryList();//获取分类导航
                setSortListHover();//分类导航hover
                cartAmount();//购物车数量
            };
            //需要登录后的点击
            function check_login(target){
                if (checkLogin.flag) {
                    location.href = $(target).attr('data-href');
                }else{
                    location.href = '/api/user/login/'
                }
            };

		    showPage({
		    	'rows':40,
		    	'page':1
		    });

		    function urlPath(url){
				var apiUrl = url;
				apiUrl = url;
				return apiUrl;
			}

		    //显示足迹商品
		    function showPage(json) {
		        showLoading();
		        // console.log("足迹商品接口进入");
		        $.ajax({
		        	url:'/api/user/trace/list',
		        	type:'GET',
		        	datatype:'json',
		        	data:{
		        		'rows':json.rows,
		        		'page':json.page
		        	},
		        	success:function(data){
		        		var data = JSON.parse(data);
		        		// console.log(data);
		        		var errno = data.errno;
		        		if (errno == 0) {
		        			// console.log("足迹商品接口回调成功---"+data);
		        			var traceSum = data.total;  //商品总数
		                    var a = 0;
		                    if(traceSum > 0) {
		                        var checkList = [];
		                        var traceDate = data.list;
		                        var itemLi = '';
		                        $.each(traceDate, function(index, item) {

		                            if(traceDate.length > 0) {
	                                    itemLi += '<li class="trace-li" itemsku="'+ item.sku +'">' +
	                                                    '<div class="item-title">' +
	                                                        '<div class="title-hr"></div>' +
	                                                    '</div>' +
	                                                    '<div>' +
	                                                        '<div class="item-image-box">' +
	                                                            '<a href=' + urlPath('/api/product/detail/?sku=' + item.sku) + ' target="_blank">' +
	                                                                '<img  placepic="true" wait="true" src="' + item.image + '" alt="' + item.name + '" title="' + item.name + '" />' +
	                                                            '</a>' +
	                                                        '</div>' +
	                                                        '<dl class="item-text">' +
	                                                            '<dt class="item-name"><a href=' + urlPath('/api/product/detail/?sku=' + item.sku) + '><span class="sales-promotion c0a2a"></span>' + item.name + '</a></dt>' +
	                                                            '<dd class="item-price">'+item.price+'<span class="unit">积分</span></dd>' +
	                                                        '</dl>' +
	                                                    '</div>' +
	                                                '</li>';
	                                } else {
	                                    itemLi += '<li class="trace-li" itemsku="'+ item.sku +'" date="' + index + '">' +
	                                                    '<div class="item-title">' +
	                                                        '<div class="trace-date-box">' +
	                                                            '<h3 class="trace-date">' + index + '</h3>' +
	                                                            '<div class="trace-num">' + content.total + '件宝贝</div>' +
	                                                        '</div>' +
	                                                        '<div class="title-hr"></div>' +
	                                                        '<div class="clear"></div>' +
	                                                    '</div>' +
	                                                    '<div>' +
	                                                        '<div class="item-image-box">' +
	                                                            '<a href=' + urlPath('/api/product/detail/?sku=' + item.sku) + ' target="_blank">' +
	                                                                '<img src="' + item.image + '" wait="true" placepic="true" alt="' + item.name + '" title="' + item.name + '" />' +
	                                                            '</a>' +
	                                                        '</div>' +
	                                                        '<dl class="item-text">' +
	                                                            '<dt class="item-name"><a href=' + urlPath('/static/i3jf/detail_page.html?sku=' + item.sku) + '>' + item.name + '</a></dt>' +
	                                                            '<dd class="item-price">--<span class="unit">积分</span></dd>' +
	                                                        '</dl>' +
	                                                    '</div>' +
	                                                '</li>';
		                                }

		                        });
								$('.trace-list').html(itemLi);
		                        // checkSkuList(checkList);
		                        hideLoading();
		                        $('#traceContent').removeClass('hidden');
		                        // slicePage(traceSum);
		                        //分页
								if(parseInt(data.total)>0)
								{
									maxinfo=40;
									var maxPage=0;
									//创建页码
									if(data.total%maxinfo == 0){
										maxpage = data.total/maxinfo;
									}else{
										maxpage = parseInt(data.total/maxinfo) + 1;
									}
									//设置分页
									if(maxpage > 0){
										topPageBtn();
										SetPage(maxpage);
										setPageAction(maxpage);
										$('.showPage .page2').html(maxpage);
									}
								}
		                    } else {
		                        hideLoading();
		                        $('#traceEmp').removeClass('hidden');
		                    }
		        		}else{
		        			// console.log("足迹商品接口回调异常---"+data);
		        		}
		        	},
		        	error:function(error){
		        		alert("足迹商品接口失败,请刷新...");
		        		var mainMsg = '足迹商品获取失败,请刷新...';
		                var msgInfo = {
		                    'mainMsg': mainMsg,
		                    'alertType': true
		                };
		                diyAlert(msgInfo,true);
		        	}
		        })
		    }




			/*=================== 分页 start=================*/
			var pageinfo=6;	//一共在页面上显示几条页码
			var maxinfo=40;	//每页最大的条数
			var searchFlag = true;
			//设置分页
			function SetPage(maxpage){
				var now_page = parseInt($('.tcdPageCode').attr('page'));
				$('.more-item').remove();
				$('.page-item').remove();
				$('.page1').text(now_page);
				$('.page2').text(maxpage);
				$('.page-info').text(now_page+'/'+maxpage);
				var start = '<div position="'+1+'" class="page-item">'+1+'</div>';
				var end = '<div position="'+maxpage+'" class="page-item">'+maxpage+'</div>';
				if(maxpage <= pageinfo){
					// console.log(111);
					if(maxpage==1)
					{
						$('#next').before(start);
						$('.rBtn').removeClass('active');
						$('.pageBtn a').off('click');
					}
					else
					{
						for(i = 2;i < maxpage;i++){
							start+='<div position="'+i+'" class="page-item">'+i+'</div>';
						}
						start+=end;
						$('#next').before(start);
					}
				}else{
					// console.log(222);
					if(now_page >= 4){
						start+= '<span class="more-item">……</span>';
					}
					if(now_page <= maxpage-3){
						end = '<span class="more-item">……</span>' + end;
					}
					var start_page = now_page - 1;
					var end_page = now_page + 1;
					if(now_page - 1 <= 1){
						start_page = 2;
						end_page=4;
					}

					if(now_page + 1 >= maxpage-1){
						start_page = maxpage - 3;
						end_page = maxpage - 1;
					}

					for(i = start_page;i <= end_page;i++){
						start+='<div position="'+i+'" class="page-item">'+i+'</div>';
					}
					start+=end;
					$('#next').before(start);
				}
				$('[position = '+now_page+']').addClass('active');
				// location.href =location.href.split('#')[0] + '#' + now_page;
				$('#next').attr('disabled',false).css('background','#fff');
				$('#prev').attr('disabled',false).css('background','#fff');
				if(now_page>=maxpage)
				{
					$('#prev').removeClass('disBtn');
					$('#next').attr('disabled',true).css({'background':'#f5f5f5','color':'#333'});
				}
				if(now_page<=1)
				{
					$('#next').removeClass('disBtn');
					$('#prev').attr('disabled',true).css({'background':'#f5f5f5','color':'#333'});
				}
			}

			//页码操作
			function setPageAction(maxpage){
				//对页码中的数字键进行点击操作
				// console.log("页码操作",maxpage);
				$('.page-item').unbind('click');
				$('.page-item').bind('click',function(){

					// console.log('页码操作');

					if(!searchFlag) return;
					if($(this).hasClass('active')) return;

					var type=$('.goodsRnav .active').attr('data-type');
					var sortOrder=$('.goodsRnav .active').attr('data-order');
					var now_page=$(this).text();

					if(now_page==maxpage)
					{
						$('#prev').attr('disabled',false).css('background','#fff');
						$('#next').attr('disabled',true).css({'background':'#f5f5f5','color':'#333'});
						$('.pageBtn a').removeClass('active');
						$('.lBtn').addClass('active');
					}
					if(now_page==1)
					{
						$('#next').attr('disabled',false).css('background','#fff');
						$('#prev').attr('disabled',true).css({'background':'#f5f5f5','color':'#333'});
						$('.pageBtn a').removeClass('active');
						$('.rBtn').addClass('active');
					}
					if(now_page>1 && now_page<maxpage)
					{
						$('#next').attr('disabled',false).css('background','#fff');
						$('#prev').attr('disabled',false).css('background','#fff');
						$('.pageBtn a').addClass('active');
					}
					$('.tcdPageCode').attr('page',$(this).text());

					showPage({
				    	'rows':maxinfo,
				    	'page':$(this).text()
				    });
				});
				//上一页，下一页点击事件
				$('.page-button').unbind('click');
				$('.page-button').bind('click',function(){
					// console.log("上下");
					if(!searchFlag) return;
					var srotType=$('.goodsRnav .active').attr('data-type');
					var sortOrder=$('.goodsRnav .active').attr('data-order');
					var type = $(this).attr('id');
					var now_page = parseInt($('.tcdPageCode').attr('page'));
					switch(type){
						case 'prev':
							if(now_page > 1){
								$('.tcdPageCode').attr('page',--now_page);
							}
						break;

						case 'next':
							if(now_page < maxpage){
								$('.tcdPageCode').attr('page',++now_page);
							}
						break;
					}
					if(now_page==1)
					{
						$('#next').removeClass('disBtn');
						$('#next').attr('disabled',false).css('background','#fff');
						$('.pageBtn a').removeClass('active');
						$('.rBtn').addClass('active');
					}
					if(now_page>1 && now_page<maxpage)
					{
						$('#next').removeClass('disBtn');
						$('#prev').removeClass('disBtn');
						$('.pageBtn a').addClass('active');
					}
					if(now_page==maxpage)
					{
						$('#prev').attr('disabled',false).css('background','#fff');
						$('#prev').removeClass('disBtn');
						$('#next').addClass('disBtn');
						$('.pageBtn a').removeClass('active');
						$('.lBtn').addClass('active');
					}

				});
			}

			//点击换页
			//上面的页码点击的时候
			function topPageBtn(){
				$('.lBtn').off('click');
				$('.rBtn').off('click');
				$('.lBtn').on('click',function (){
					// console.log("上下切换");
					if(!searchFlag) return;
					var type=$('.goodsRnav .active').attr('data-type');
					var sortOrder=$('.goodsRnav .active').attr('data-order');
					var n=parseInt($('.page1').html());
					var num=parseInt($('.page2').html());
					if(n>1 && n<=num)
					{
						//调用数据查询接口
						$('.pageBtn a').addClass('active');
						n--;
					}
					$('.page1').html(n);
					if(n==1)
					{
						$(this).removeClass('active').off('click');
						$('#prev').attr('disabled',true).css({'background':'#f5f5f5','color':'#333'});
					}
					//循环，然后给下面的页码中的html为n的页，添加class名
					$('.page-item').removeClass('active');
					$('.tcdPageCode').attr('page',n);
					$('.page-info').text(n+'/'+num);
					$.each($('.page-item'),function (index,element){
						if($(this).html()==n && $(this).html()!=num)
						{
							$(this).addClass('active');
							$('#next').attr('disabled',false).css('background','#fff');
						}
					});
					// location.href =location.href.split('#')[0] + '#' + n;
					setPageAction(num);
				});

				$('.rBtn').on('click',function (){
					if(!searchFlag) return;
					var type=$('.goodsRnav .active').attr('data-type');
					var sortOrder=$('.goodsRnav .active').attr('data-order');
					var n=parseInt($('.page1').html());
					var num=parseInt($('.page2').html());
					if(n>=1 && n<num)
					{
						$('.pageBtn a').addClass('active');
						$('#prev').attr('disabled',false).css('background','#fff');
						//调用数据查询接口
						n++;
					}
					$('.page1').html(n);
					if(n==num)
					{
						$(this).removeClass('active');
						$(this).off('click');
						$('#next').attr('disabled',true).css({'background':'#f5f5f5','color':'#333'});
					}
					$('.tcdPageCode').attr('page',n);
					$('.page-info').text(n+'/'+num);
					$('.page-item').removeClass('active');
					//循环，然后给下面的页码中的html为n的页，添加class名
					$.each($('.page-item'),function (){
						if($(this).html()==n && $(this).html()!=1)
						{
							$(this).addClass('active');
							$('#prev').attr('disabled',false).css('background','#fff');
						}
					});
					// location.href = location.href.split('#')[0] + '#' + n;
					setPageAction(num);
				});
			}
		    //判断是否全部获取完成
		    function checkLoadPrice(allValue){
		        var flag = true;
		        $.each(loadList,function(index,content){
		            if(!content){
		                flag = false;
		                return false;
		            }
		        });
		        if(flag){
		            loadList = [];
		        }
		    }

		    //等待显示转圈
		    function showLoading() {
		        $('#loading').removeClass('hidden');
		    }

		    //隐藏转圈
		    function hideLoading() {
		        $('#loading').addClass('hidden');
		    }
		</script>

</body></html>